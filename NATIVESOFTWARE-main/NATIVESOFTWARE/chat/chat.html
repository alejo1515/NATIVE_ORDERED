<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Chat - Native Social Media">
    <title>Chat - Native Social Media</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../../styles/main.css">
    <!-- Bootstrap Overrides -->
    <link rel="stylesheet" href="../../styles/bootstrap-overrides.css">
</head>

<body>
    <!-- Navegación Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a href="index.html" class="navbar-brand">
                <i class="bi bi-code-slash me-2"></i>
                Native Social Media
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuLateral">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Menú Lateral -->
            <div class="offcanvas offcanvas-start" id="menuLateral" tabindex="-1">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title">
                        <i class="bi bi-code-slash me-2"></i>
                        Native Social Media
                    </h5>
                    <button class="btn-close btn-close-white" type="button" data-bs-dismiss="offcanvas"></button>
                </div>

                <div class="offcanvas-body d-flex flex-column justify-content-between">
                    <ul class="navbar-nav fs-5">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <i class="bi bi-house-door"></i>
                                Inicio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="muro.html" class="nav-link">
                                <i class="bi bi-grid-3x3-gap"></i>
                                Muro
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="perfil.html" class="nav-link">
                                <i class="bi bi-person-circle"></i>
                                Perfil
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="chat.html" class="nav-link active">
                                <i class="bi bi-chat-dots"></i>
                                Chat
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="configuracion.html" class="nav-link">
                                <i class="bi bi-gear"></i>
                                Configuración
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="login.html" class="nav-link text-danger">
                                Salir
                            </a>
                        </li>
                    </ul>

                    <!-- Redes Sociales -->
                    <div class="d-lg-none text-center py-3">
                        <a href="#" class="text-info fs-4 me-3"><i class="bi bi-twitter"></i></a>
                        <a href="#" class="text-info fs-4 me-3"><i class="bi bi-facebook"></i></a>
                        <a href="#" class="text-info fs-4 me-3"><i class="bi bi-github"></i></a>
                        <a href="#" class="text-info fs-4"><i class="bi bi-whatsapp"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="container-fluid mt-5 pt-4">
        <!-- Separador Visual -->
        <div class="content-separator"></div>

        <div class="row">
            <!-- Lista de Contactos -->
            <div class="col-lg-4 col-md-5 mb-4">
                <div class="card fade-in">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">
                            <i class="bi bi-people me-2"></i>
                            Conversaciones
                        </h6>
                        <button class="btn btn-sm btn-primary">
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="contactList">
                            <!-- Contactos se generan dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Principal -->
            <div class="col-lg-8 col-md-7">
                <div class="chat-container fade-in">
                    <!-- Header del Chat -->
                    <div class="chat-header d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <img src="" alt="Contacto" class="rounded-circle me-3 user-avatar" width="40" height="40"
                                data-user-name="Usuario">
                            <div>
                                <h6 class="mb-0" id="chatTitle">Selecciona una conversación</h6>
                                <small class="text-muted" id="chatStatus">En línea</small>
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-outline-secondary" id="searchBtn">
                                <i class="bi bi-search"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="moreBtn">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Área de Chat -->
                    <div class="chat-messages" id="messageArea">
                        <!-- Mensaje de bienvenida -->
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-chat-dots fs-1 mb-3 d-block"></i>
                            <p>Selecciona una conversación para comenzar a chatear</p>
                        </div>
                    </div>

                    <!-- Área de Entrada -->
                    <div class="chat-input">
                        <button class="btn btn-outline-secondary btn-sm" id="attachBtn">
                            <i class="bi bi-paperclip"></i>
                        </button>
                        <input type="text" id="messageInput" placeholder="Escribe un mensaje..." class="form-control">
                        <button class="btn btn-primary btn-sm" id="sendBtn">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="js/app.js"></script>

    <script>
        // Datos de ejemplo para el chat
        const contacts = [
            {
                id: 1,
                name: 'Jorge Luis Carranza',
                avatar: '',
                lastMessage: 'Hola, ¿cómo estás?',
                time: '2 min',
                unread: 2,
                online: true
            },
            {
                id: 2,
                name: 'María García',
                avatar: '',
                lastMessage: 'Perfecto, nos vemos mañana',
                time: '1 hora',
                unread: 0,
                online: false
            },
            {
                id: 3,
                name: 'Carlos Rodríguez',
                avatar: '',
                lastMessage: '¿Tienes el código del proyecto?',
                time: '3 horas',
                unread: 1,
                online: true
            }
        ];

        const messages = {
            1: [
                { id: 1, text: 'Hola, ¿cómo estás?', sent: false, time: '14:30' },
                { id: 2, text: '¡Hola! Muy bien, ¿y tú?', sent: true, time: '14:31' },
                { id: 3, text: 'Excelente, ¿cómo va el proyecto?', sent: false, time: '14:32' }
            ],
            2: [
                { id: 1, text: '¿Quedamos mañana para revisar el código?', sent: true, time: '13:00' },
                { id: 2, text: 'Perfecto, nos vemos mañana', sent: false, time: '13:05' }
            ],
            3: [
                { id: 1, text: '¿Tienes el código del proyecto?', sent: false, time: '11:00' },
                { id: 2, text: 'Sí, te lo envío en un momento', sent: true, time: '11:15' }
            ]
        };

        let currentChat = null;

        // Inicializar la aplicación de chat
        document.addEventListener('DOMContentLoaded', function () {
            loadContacts();
            setupEventListeners();
        });

        function loadContacts() {
            const contactList = document.getElementById('contactList');
            contactList.innerHTML = '';

            contacts.forEach(contact => {
                const contactElement = createContactElement(contact);
                contactList.appendChild(contactElement);
            });
        }

        function createContactElement(contact) {
            const div = document.createElement('div');
            div.className = 'list-group-item list-group-item-action d-flex align-items-center p-3';
            
            // Generar avatar por defecto si no hay imagen
            const avatarSrc = contact.avatar || app.getDefaultAvatar(contact.name, 40);
            
            div.innerHTML = `
                <div class="position-relative me-3">
                    <img src="${avatarSrc}" alt="${contact.name}" class="rounded-circle user-avatar" width="40" height="40" data-user-name="${contact.name}">
                    ${contact.online ? '<span class="position-absolute bottom-0 end-0 bg-success rounded-circle" style="width: 12px; height: 12px; border: 2px solid white;"></span>' : ''}
                </div>
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start">
                        <h6 class="mb-1">${contact.name}</h6>
                        <small class="text-muted">${contact.time}</small>
                    </div>
                    <p class="mb-1 text-muted small">${contact.lastMessage}</p>
                </div>
                ${contact.unread > 0 ? `<span class="badge bg-primary rounded-pill">${contact.unread}</span>` : ''}
            `;

            div.addEventListener('click', () => openChat(contact.id));
            return div;
        }

        function openChat(contactId) {
            currentChat = contactId;
            const contact = contacts.find(c => c.id === contactId);

            // Actualizar header
            document.getElementById('chatTitle').textContent = contact.name;
            document.getElementById('chatStatus').textContent = contact.online ? 'En línea' : 'Desconectado';

            // Actualizar avatar del header del chat
            const chatAvatar = document.querySelector('.chat-header .user-avatar');
            if (chatAvatar) {
                const avatarSrc = contact.avatar || app.getDefaultAvatar(contact.name, 40);
                chatAvatar.src = avatarSrc;
                chatAvatar.setAttribute('data-user-name', contact.name);
            }

            // Cargar chat
            loadMessages(contactId);

            // Marcar como leído
            contact.unread = 0;
            loadContacts();
        }

        function loadMessages(contactId) {
            const messageArea = document.getElementById('messageArea');
            const chatMessages = messages[contactId] || [];

            messageArea.innerHTML = '';

            chatMessages.forEach(message => {
                const messageElement = createMessageElement(message);
                messageArea.appendChild(messageElement);
            });

            // Scroll al final
            messageArea.scrollTop = messageArea.scrollHeight;
        }

        function createMessageElement(message) {
            const div = document.createElement('div');
            div.className = `message ${message.sent ? 'sent' : 'received'} fade-in`;
            div.innerHTML = `
                <div class="message-content">
                    <p class="mb-1">${message.text}</p>
                    <small class="text-muted">${message.time}</small>
                </div>
            `;
            return div;
        }

        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const attachBtn = document.getElementById('attachBtn');

            // Enviar mensaje con Enter
            messageInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Enviar mensaje con botón
            sendBtn.addEventListener('click', sendMessage);

            // Adjuntar archivo
            attachBtn.addEventListener('click', function () {
                app.showSuccess('Funcionalidad de adjuntar archivo próximamente');
            });

            // Búsqueda
            document.getElementById('searchBtn').addEventListener('click', function () {
                app.showSuccess('Funcionalidad de búsqueda próximamente');
            });
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            if (!message || !currentChat) return;

            // Agregar mensaje a la lista
            const newMessage = {
                id: Date.now(),
                text: message,
                sent: true,
                time: new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })
            };

            if (!messages[currentChat]) {
                messages[currentChat] = [];
            }
            messages[currentChat].push(newMessage);

            // Mostrar mensaje
            const messageElement = createMessageElement(newMessage);
            document.getElementById('messageArea').appendChild(messageElement);

            // Limpiar input y hacer scroll
            messageInput.value = '';
            document.getElementById('messageArea').scrollTop = document.getElementById('messageArea').scrollHeight;

            // Simular respuesta automática
            setTimeout(() => {
                const responseMessage = {
                    id: Date.now() + 1,
                    text: 'Mensaje recibido correctamente',
                    sent: false,
                    time: new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })
                };

                messages[currentChat].push(responseMessage);
                const responseElement = createMessageElement(responseMessage);
                document.getElementById('messageArea').appendChild(responseElement);
                document.getElementById('messageArea').scrollTop = document.getElementById('messageArea').scrollHeight;
            }, 1000);
        }
    </script>
</body>

</html>